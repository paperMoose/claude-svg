{"version":3,"file":"ext-eyedropper.js","sources":["../../../../src/editor/extensions/ext-eyedropper/ext-eyedropper.js","../../../../src/editor/extensions/ext-eyedropper/locale/en.js","../../../../src/editor/extensions/ext-eyedropper/locale/fr.js","../../../../src/editor/extensions/ext-eyedropper/locale/sv.js","../../../../src/editor/extensions/ext-eyedropper/locale/tr.js","../../../../src/editor/extensions/ext-eyedropper/locale/uk.js","../../../../src/editor/extensions/ext-eyedropper/locale/zh-CN.js"],"sourcesContent":["/**\n * @file ext-eyedropper.js\n *\n * @license MIT\n *\n * @copyright 2010 Jeff Schiller\n * @copyright 2021 OptimistikSAS\n *\n */\n\nconst name = 'eyedropper'\n\nconst loadExtensionTranslation = async function (svgEditor) {\n  let translationModule\n  const lang = svgEditor.configObj.pref('lang')\n  try {\n    translationModule = await import(`./locale/${lang}.js`)\n  } catch (_error) {\n    console.warn(`Missing translation (${lang}) for ${name} - using 'en'`)\n    translationModule = await import('./locale/en.js')\n  }\n  svgEditor.i18next.addResourceBundle(lang, name, translationModule.default)\n}\n\nexport default {\n  name,\n  async init () {\n    const svgEditor = this\n    const { svgCanvas } = svgEditor\n    await loadExtensionTranslation(svgEditor)\n    const { ChangeElementCommand } = svgCanvas.history\n    // svgdoc = S.svgroot.parentNode.ownerDocument,\n    const addToHistory = (cmd) => { svgCanvas.undoMgr.addCommandToHistory(cmd) }\n    const currentStyle = {}\n    const { $id, $click } = svgCanvas\n\n    // Helper to show what style is currectly picked\n    const helperCursor = document.createElement('div')\n    helperCursor.style.width = '14px'\n    helperCursor.style.height = '14px'\n    helperCursor.style.position = 'absolute'\n    svgEditor.workarea.appendChild(helperCursor)\n\n    const styleHelper = () => {\n      const mode = svgCanvas.getMode()\n\n      if (mode === name) {\n        helperCursor.style.display = 'block'\n\n        const strokeWidthNum = Number(currentStyle.strokeWidth)\n        const borderStyle = currentStyle.strokeDashArray === 'none' || !currentStyle.strokeDashArray ? 'solid' : 'dotted'\n\n        helperCursor.style.background = currentStyle.fillPaint ?? 'transparent'\n        helperCursor.style.opacity = currentStyle.opacity ?? 1\n        helperCursor.style.border = (strokeWidthNum > 0 && currentStyle.strokePaint) ? `2px ${borderStyle} ${currentStyle.strokePaint}` : 'none'\n      }\n    }\n\n    const resetCurrentStyle = () => {\n      const keys = Object.keys(currentStyle)\n\n      keys.forEach(key => delete currentStyle[key])\n    }\n\n    const cancelHandler = () => {\n      if (Object.keys(currentStyle).length > 0) {\n        resetCurrentStyle()\n        styleHelper()\n      } else {\n        svgEditor.leftPanel.clickSelect()\n      }\n    }\n\n    /**\n     *\n     * @param {module:svgcanvas.SvgCanvas#event:ext_selectedChanged|module:svgcanvas.SvgCanvas#event:ext_elementChanged} opts\n     * @returns {void}\n     */\n    const getStyle = (opts) => {\n      let elem = null\n      if (!opts.multiselected && opts.elems[0] &&\n        !['svg', 'g', 'use'].includes(opts.elems[0].nodeName)\n      ) {\n        elem = opts.elems[0]\n        // grab the current style\n        currentStyle.fillPaint = elem.getAttribute('fill') || 'black'\n        currentStyle.fillOpacity = elem.getAttribute('fill-opacity') || 1.0\n        currentStyle.strokePaint = elem.getAttribute('stroke')\n        currentStyle.strokeOpacity = elem.getAttribute('stroke-opacity') || 1.0\n        currentStyle.strokeWidth = elem.getAttribute('stroke-width')\n        currentStyle.strokeDashArray = elem.getAttribute('stroke-dasharray')\n        currentStyle.strokeLinecap = elem.getAttribute('stroke-linecap')\n        currentStyle.strokeLinejoin = elem.getAttribute('stroke-linejoin')\n        currentStyle.opacity = elem.getAttribute('opacity') || 1.0\n      }\n    }\n\n    return {\n      name: svgEditor.i18next.t(`${name}:name`),\n      callback () {\n        // Add the button and its handler(s)\n        const title = `${name}:buttons.0.title`\n        // const key = `${name}:buttons.0.key`\n        const key = 'ctrl+I'\n        const buttonTemplate = `\n        <se-button id=\"tool_eyedropper\" title=\"${title}\" src=\"eye_dropper.svg\" shortcut=${key}></se-button>\n        `\n        svgCanvas.insertChildAtIndex($id('tools_left'), buttonTemplate, 12)\n        $click($id('tool_eyedropper'), () => {\n          if (this.leftPanel.updateLeftPanel('tool_eyedropper')) {\n            svgCanvas.setMode(name)\n          }\n        })\n\n        // enables helper, resets currently picked style if no element selected\n        document.addEventListener('modeChange', e => {\n          if (svgCanvas.getMode() === name) {\n            styleHelper()\n          } else {\n            helperCursor.style.display = 'none'\n          }\n          if (svgCanvas.getSelectedElements().length === 0) {\n            resetCurrentStyle()\n          }\n        })\n\n        // Positions helper\n        svgEditor.workarea.addEventListener('mousemove', (e) => {\n          const x = e.clientX\n          const y = e.clientY\n\n          if (svgCanvas.getMode() === name) {\n            helperCursor.style.top = y + 'px'\n            helperCursor.style.left = x + 12 + 'px'\n            styleHelper()\n          }\n        })\n\n        svgEditor.workarea.addEventListener('mouseleave', e => {\n          helperCursor.style.display = 'none'\n        })\n\n        // Listens to Esc to reset currently picked style / set Select mode\n        document.addEventListener('keydown', e => {\n          if (e.key === 'Escape' && svgCanvas.getMode() === name) {\n            cancelHandler()\n          }\n        })\n      },\n      // if we have selected an element, grab its paint and enable the eye dropper button\n      selectedChanged: getStyle,\n      mouseDown (opts) {\n        const mode = svgCanvas.getMode()\n        if (mode === name) {\n          const e = opts.event\n          const { target } = e\n          if (!['svg', 'g', 'use'].includes(target.nodeName)) {\n            const changes = {}\n\n            // If some style is picked - applies it to the target, if no style - picks it from the target\n            if (Object.keys(currentStyle).length > 0) {\n              const change = function (elem, attrname, newvalue) {\n                changes[attrname] = elem.getAttribute(attrname)\n                elem.setAttribute(attrname, newvalue)\n              }\n\n              if (currentStyle.fillPaint) { change(target, 'fill', currentStyle.fillPaint) }\n              if (currentStyle.fillOpacity) { change(target, 'fill-opacity', currentStyle.fillOpacity) }\n              if (currentStyle.strokePaint) { change(target, 'stroke', currentStyle.strokePaint) }\n              if (currentStyle.strokeOpacity) { change(target, 'stroke-opacity', currentStyle.strokeOpacity) }\n              if (currentStyle.strokeWidth) { change(target, 'stroke-width', currentStyle.strokeWidth) }\n              if (currentStyle.opacity) { change(target, 'opacity', currentStyle.opacity) }\n              if (currentStyle.strokeLinecap) { change(target, 'stroke-linecap', currentStyle.strokeLinecap) }\n              if (currentStyle.strokeLinejoin) { change(target, 'stroke-linejoin', currentStyle.strokeLinejoin) }\n\n              if (currentStyle.strokeDashArray) {\n                change(target, 'stroke-dasharray', currentStyle.strokeDashArray)\n              } else {\n                target.removeAttribute('stroke-dasharray')\n              }\n\n              addToHistory(new ChangeElementCommand(target, changes))\n            } else {\n              getStyle({ elems: [target] })\n            }\n          }\n        }\n      }\n    }\n  }\n}\n","export default {\n  name: 'eyedropper',\n  buttons: [\n    {\n      title: 'Eye Dropper Tool',\n      key: 'I'\n    }\n  ]\n}\n","export default {\n  name: 'pipette',\n  buttons: [\n    {\n      title: 'Outil pipette',\n      key: 'I'\n    }\n  ]\n}\n","export default {\n  name: 'pipett',\n  buttons: [\n    {\n      title: 'pipettverktyg',\n      key: 'I'\n    }\n  ]\n}\n","export default {\n  name: 'renkseçici',\n  buttons: [\n    {\n      title: 'Renk Seçim Aracı',\n      key: 'I'\n    }\n  ]\n}\n","export default {\n  name: 'eyedropper',\n  buttons: [\n    {\n      title: 'Піпетка',\n      key: 'I'\n    }\n  ]\n}\n","export default {\n  name: '滴管',\n  buttons: [\n    {\n      title: '滴管工具',\n      key: 'I'\n    }\n  ]\n}\n"],"names":["name","loadExtensionTranslation","async","svgEditor","translationModule","lang","configObj","pref","__variableDynamicImportRuntime0__","_error","console","warn","Promise","resolve","then","en$1","i18next","addResourceBundle","default","extEyedropper","init","this","svgCanvas","ChangeElementCommand","history","currentStyle","$id","$click","helperCursor","document","createElement","style","width","height","position","workarea","appendChild","styleHelper","getMode","display","strokeWidthNum","Number","strokeWidth","borderStyle","strokeDashArray","background","fillPaint","opacity","border","strokePaint","resetCurrentStyle","Object","keys","forEach","key","getStyle","opts","elem","multiselected","elems","includes","nodeName","getAttribute","fillOpacity","strokeOpacity","strokeLinecap","strokeLinejoin","t","callback","buttonTemplate","insertChildAtIndex","leftPanel","updateLeftPanel","setMode","addEventListener","e","getSelectedElements","length","x","clientX","y","clientY","top","left","clickSelect","selectedChanged","mouseDown","event","target","changes","change","attrname","newvalue","setAttribute","removeAttribute","cmd","undoMgr","addCommandToHistory","buttons","title"],"mappings":"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"}